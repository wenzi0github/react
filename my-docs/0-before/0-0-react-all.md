# React18 源码之整体架构

无论是出于什么目的来阅读 React 的源码，如想阅读高质量的代码，或者想知道 hooks 是怎么运作的，再或者就单纯是为了面试，我们都要细心地去阅读源码。

怎么读 React 源码，很多人都已经有阅读其他源码的经验了，不过这里我们还是要明确几点。

## 1. 这个框架是真真用过的

如果这个框架或者组件用的很浅，甚至是没用过，那阅读起源码来，确实比较费劲，这个框架或者组件您至少得知道怎么用。如我之前基于 axios 封装过数据请求组件，那关于 axios 的 api 太熟悉不过了，然后在阅读 axios 源码时，就能知道这些对外的 api、参数等在内部是经过了哪些处理。

## 2. 阅读过官方文档

在阅读源码前，我们先把官方文档过一遍，如[React 的中文文档](https://zh-hans.reactjs.org/docs/getting-started.html)；很多问题在官方文档上就能找到答案，同时我们也再次熟悉下这些 api；会有不一样的认知；

## 3. 有大局观念

我们先对 React18 源码有个大概的认知，建立起一个大致的大局观，然后再从细节入手。要不然直接去看源码细节，可能会云里雾里，导致无所适从。

阅读源码时很容易钻牛角尖，当遇到一个不太理解的原理时，就被困到这里了，然后把之间建立起来的框架结构全给忘了。

比如我刚开始就想看下 useState() 和 useEffect() 等几个 hooks 的源码实现，结果看着看着就看不动，因为他还会引用其他文件的函数，还有一些全局变量的操作等等。越看就越抓瞎。

这里我们是建议从入口方法入手，在 React18 中，就是`createRoot()`和`render()`两个方法。

## 4. 带着问题去看

整套代码搭建了一套完整的、自我闭环的框架，如果漫无目的的看，会容易被其他事情打断，热情也也会慢慢减退，导致虎头蛇尾。

因此在阅读源码之前，我们就先列出几个问题，遇到的时候就会格外关注，如：

- 虚拟 dom 是怎么生成的？
- 函数组件和 class 组件渲染有什么不同？
- 虚拟 dom 是否比直接操作原生 dom 要快？
- 虚拟 dom 如何转变成真实的 dom？
- 什么是 jsx？
- render()的原理是什么？
- hook 都有哪些，是如何工作的？
- diff 算法是什么？内部是如何判断哪些节点需要变更？
- react 中如何处理事件？
- fiber 是什么，react 为什么要采用这种结构？

那么在阅读源码时就会尤其注意这些问题，即使中间被其他事情耽误几天，再回来的时候，我们还能从这些问题中，找回点看源码的热情。

## 5. 多记录

对阅读到的方法、参数等，记录下他们的作用是什么，在什么地方调用了、修改了，整套的调用链是什么等等。

当某一块的功能比较完整时，可以用自己的语言叙述出来，假装给一个不懂的人来讲述这段代码和功能。

同时，还要画流程图，因为有些地方调用链路会比较深，若不画流程图的话，很容易导致前后的逻辑对应不上。

[如何阅读一份源代码？](https://www.codedump.info/post/20190324-how-to-read-code/)
